# 一键运行完整指南

## 🚀 最简单的方法

只需要运行一个命令,就能生成Part A、B、C的所有结果!

### Linux/Mac用户:

```bash
cd ~/COMP3014J_Lab
chmod +x run_all.sh
./run_all.sh
```

### 脚本会自动完成:

✅ **Part A (40分):**
1. 运行4种TCP变体 (Reno, Cubic, Vegas, Yeah)
2. 生成DropTail trace文件
3. 计算吞吐量、PLR、公平性、稳定性
4. 生成4子图对比图表

✅ **Part B (35分):**
1. 自动创建RED版本的TCL文件
2. 运行所有RED仿真
3. 对比DropTail vs RED
4. 生成4子图对比图表

✅ **Part C (25分):**
1. 删除旧的运行文件(确保重新生成)
2. 运行Cubic 5次,每次使用不同随机种子
3. 验证文件是否不同
4. 计算均值和95%置信区间
5. 生成4子图可重复性图表

✅ **自动分析:**
1. 运行 analyser3.py 生成所有图表和CSV
2. 检查文件是否成功生成
3. 显示完整的结果摘要

## 📊 生成的文件

运行完成后,你会得到:

### 图表文件 (直接用于报告)
```
partA_comparison.png      - Part A: 4个子图 (吞吐量、PLR、公平性、稳定性)
partB_comparison.png      - Part B: 4个子图 (DropTail vs RED对比)
partC_reproducibility.png - Part C: 4个子图 (5次运行+统计分析)
```

### 数据文件
```
partA_goodput_plr.csv     - Part A的数据表格
```

### Trace文件 (用于分析)
```
renoTrace.tr, cubicTrace.tr, vegasTrace.tr, yeahTrace.tr    (DropTail)
renoTrace_red.tr, ... (RED)
cubicTrace_run1.tr, cubicTrace_run2.tr, ... cubicTrace_run5.tr (可重复性)
```

## 🔧 关键改进

### Part C 的修复:

**旧版本问题:**
- 使用 `sed` 插入随机种子,语法不稳定
- 5次运行结果完全相同

**新版本改进:**
- ✅ 使用 `awk` 正确插入NS2随机种子
- ✅ 每次使用不同的种子值:
  ```
  Run 1: seed 18134
  Run 2: seed 30479
  Run 3: seed 42824
  Run 4: seed 55169
  Run 5: seed 67514
  ```
- ✅ 使用正确的NS2 RNG语法:
  ```tcl
  set rng [new RNG]
  $rng seed 18134
  ```
- ✅ 自动删除旧文件,确保重新生成
- ✅ 验证文件是否不同

## 📝 运行日志示例

```
==========================================
TCP性能分析 - 自动化运行脚本
==========================================
工作目录: /home/user/COMP3014J_Lab

Part A: 运行DropTail仿真...
------------------------------------------
运行 Reno...
运行 Cubic...
运行 Vegas...
运行 Yeah...
DropTail仿真完成!

Part B: 准备RED仿真...
------------------------------------------
运行 reno (RED)...
运行 cubic (RED)...
运行 vegas (RED)...
运行 yeah (RED)...
RED仿真完成!

Part C: 运行可重复性测试 (5次运行)...
------------------------------------------
清理旧的可重复性测试文件...
运行 cubic - 第 1 次...
  随机种子: 18134
  输出文件: cubicTrace_run1.tr
  ✓ 完成! 文件大小: 245K
运行 cubic - 第 2 次...
  随机种子: 30479
  输出文件: cubicTrace_run2.tr
  ✓ 完成! 文件大小: 248K
运行 cubic - 第 3 次...
  随机种子: 42824
  输出文件: cubicTrace_run3.tr
  ✓ 完成! 文件大小: 243K
...

验证文件差异...
  ✓ 文件大小不同,随机性正常
可重复性测试完成!

==========================================
运行分析脚本...
==========================================

运行 analyser3.py (主分析)...
✓ analyser3.py 运行成功

==========================================
检查生成的文件...
==========================================

图表文件:
  ✓ partA_comparison.png (245K)
  ✓ partB_comparison.png (312K)
  ✓ partC_reproducibility.png (289K)

CSV文件:
  ✓ partA_goodput_plr.csv (5 行)

Trace文件:
  DropTail: 4 个
  RED: 4 个
  可重复性测试: 5 个

==========================================
所有任务完成!
==========================================
```

## ⚡ 快速检查

运行完成后,快速验证:

### 1. 检查图表
```bash
ls -lh *.png
```

应该看到3个PNG文件。

### 2. 查看Part C是否有差异
```bash
ls -lh cubicTrace_run*.tr
```

**成功的标志**: 5个文件大小不同
```
245K cubicTrace_run1.tr
248K cubicTrace_run2.tr
243K cubicTrace_run3.tr
247K cubicTrace_run4.tr
244K cubicTrace_run5.tr
```

### 3. 查看图表
```bash
eog partA_comparison.png &
eog partB_comparison.png &
eog partC_reproducibility.png &
```

或
```bash
xdg-open partA_comparison.png
```

## 🛠️ 如果出现问题

### 问题1: NS2命令找不到
```bash
# 检查NS2
which ns

# 如果找不到,安装NS2
sudo apt-get install ns2
```

### 问题2: Python包缺失
```bash
# 安装依赖
sudo apt-get install python3-matplotlib python3-numpy

# 或使用pip
pip3 install matplotlib numpy
```

### 问题3: 权限问题
```bash
# 给予执行权限
chmod +x run_all.sh
```

### 问题4: Part C结果仍然相同
```bash
# 手动清理并重新运行
rm -f cubicTrace_run*.tr
./run_all.sh
```

### 问题5: awk命令错误
```bash
# 检查awk版本
awk --version

# 如果有问题,使用Python脚本替代
python3 generate_runs.py
python3 analyser3.py
```

## 🎯 报告撰写

运行完成后,你的报告结构:

```markdown
# COMP3014J - TCP性能分析报告

## Part A: TCP变体分析

[插入 partA_comparison.png]

### 分析
从4个子图可以看出:
1. 吞吐量对比 - XXX表现最好
2. PLR对比 - XXX丢包率最低
3. 公平性对比 - XXX最公平(Jain指数最接近1)
4. 稳定性对比 - XXX最稳定(CoV最小)

### 结论
综合评估...

## Part B: DropTail vs RED

[插入 partB_comparison.png]

### 对比分析
DropTail和RED在以下方面有差异:
1. 吞吐量...
2. 丢包率...
3. 公平性...
4. 稳定性...

### 结论
RED相比DropTail...

## Part C: 可重复性测试

[插入 partC_reproducibility.png]

### 统计结果
- Goodput: XXX ± XX Mbps (95% CI)
- PLR: X.XX ± X.XX % (95% CI)

### 可重复性讨论
从图中可以看出,5次运行结果有一定变化...
```

## 💡 专业提示

1. **首次运行**: 完整运行大约需要5-10分钟
2. **重复运行**: 如果文件已存在会跳过,只运行缺失的部分
3. **完全重新开始**: 删除所有.tr文件后重新运行
4. **只更新图表**: 直接运行 `python3 analyser3.py`
5. **保存输出**: `./run_all.sh | tee run_log.txt` 保存运行日志

## ✅ 检查清单

运行完成后,确认:

- [ ] partA_comparison.png 有4个子图
- [ ] partB_comparison.png 有4个子图,每个显示DropTail vs RED
- [ ] partC_reproducibility.png 有4个子图,显示5次运行
- [ ] Part C的5个柱状图高度**不同**(不是完全相同)
- [ ] partA_goodput_plr.csv 包含4行数据
- [ ] 所有图表清晰,标签完整

## 🎉 完成!

运行一次 `./run_all.sh`,所有Part A、B、C的结果就全部生成了!

直接使用这些图表和数据完成你的报告吧! 📊✨

